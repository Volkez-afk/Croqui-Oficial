<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Solicitar</title>
<link rel="stylesheet" href="style.css">
<script src="supabase.js"></script>
</head>

<body>

<h2>Solicitação de Croqui</h2>

<input id="nome" placeholder="Nome">
<input id="cpf" placeholder="CPF">
<input id="endereco" placeholder="Endereço">

<button onclick="enviar()">Enviar</button>

<script type="module">
import { supabase } from './supabase.js'

window.mostrarCampos = function() {
    const tipo = document.querySelector('input[name="tipoCroqui"]:checked');
    const botao = document.getElementById("btnEnviar");

    if (!tipo) {
        botao.disabled = true;
        return;
    }

    botao.disabled = false;
    document.getElementById("dadosImovel").classList.remove("hidden");
    
    if (tipo.value === "oficial") {
        document.getElementById("croquiOficial").classList.remove("hidden");
    } else {
        document.getElementById("croquiOficial").classList.add("hidden");
    }
}

window.enviarSolicitacao = async function(){

    const { data: user } = await supabase.auth.getUser()

    const solicitacao = {
        usuario_id: user.user.id,
        tipo: document.querySelector('input[name="tipoCroqui"]:checked').value,
        nome: document.getElementById('nomeCompleto').value,
        cpf: document.getElementById('cpf').value,
        iptu: document.getElementById('iptu').value,
        endereco: document.getElementById('logradouro').value,
        numero: document.getElementById('numero').value,
        bairro: document.getElementById('bairro').value,
        quadra: document.getElementById('quadra').value,
        lote: document.getElementById('lote').value,
        status: 'pendente'
    }

    const {error} = await supabase.from('solicitacoes').insert([solicitacao])

    if(error){
        alert(error.message)
    }else{
        alert("Solicitação enviada com sucesso!")
        window.location.href="index.html"
    }
}
</script>
